<!DOCTYPE html>
<html>

<head>
    <title>You're offline</title>

    <style type="text/css">
        body {
            margin: 0 auto;
            max-width: 40em;
            width: 88%;
        }

        img {
            height: auto;
            max-width: 100%;
        }
    </style>
</head>

<body>

    <h1>Offline</h1>

    <p>On no, you're not online! Don't worry. You can visit any pages you've already been to.</p>

    <div data-offline></div>


    <script>
        (function() {
            if (!navigator || !navigator.serviceWorker) return;
            caches.keys().then(function(keys) {
                return keys.filter(function(key) {
                    return key.includes('_pages');
                }).forEach(function(key) {
                    caches.open(key).then(function(cache) {
                        cache.keys().then(function(keys) {
                            var offline = document.querySelector('[data-offline]');
                            offline.innerHTML =
                                '<ul>' +
                                keys.map(function(key) {
                                    if (!key.url.endsWith('/')) return '';
                                    return '<li><a href="' + key.url + '">' + key.url + '</a></li>';
                                }).join('') +
                                '</ul>';
                        });
                    });
                });
            });
        })();
    </script>

</body>

</html>